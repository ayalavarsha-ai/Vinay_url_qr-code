<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Portal</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>Welcome to the Data Portal</h1>
<h2 id="full-name">Loading...</h2>
<p id="dob"></p>
<p id="address"></p>
<p id="phone"></p>
<p id="email"></p>
<p id="allergies"></p>
<p id="bloodtype"></p>
<p id="DNR"></p>
<p id="insuranceprovider"></p>
<p id="medications"></p>
<p id="pastsurgeries"></p>
<p id="policynumber"></p>
<p id="preexistingconditions"></p>
<p id="preferredhospital"></p>
<p id="preferredlanguage"></p>
<p id="pcontactname"></p>
<p id="pcontactphone"></p>
<p id="pphysicianname"></p>
<p id="pphysicianphone"></p>
<p id="relationship"></p>
<p id="timestamp"></p>

<!-- Profile Picture -->
<div id="profile-picture-container">
    <h3>Profile Picture</h3>
    <img id="profile-picture" src="" alt="Profile Picture"
         style="max-width: 150px; max-height: 150px; display: none;"/>
</div>

<!-- PDF Preview -->
<div id="pdf-preview-container">
    <h3>PDF Preview</h3>
    <iframe id="pdf-preview" src=""
            style="width: 100%; height: 500px; display: none; border: 1px solid #ccc;"></iframe>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDNtdXr47xjKQOydo96uvzjYviZmO31jPo",
      authDomain: "rapidx-c05d4.firebaseapp.com",
      projectId: "rapidx-c05d4",
      storageBucket: "rapidx-c05d4.appspot.com",
      messagingSenderId: "340185921376",
      appId: "1:340185921376:web:5d088b0e41e027439bd005",
      measurementId: "G-25K8KBB70R"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Extract Document ID from URL Query Parameters
    const params = new URLSearchParams(window.location.search);
    const docId = params.get('id'); // Get the 'id' query parameter
    console.log("Document ID from URL:", docId);

    async function fetchData() {
      if (!docId) {
        console.error("No Document ID provided in the URL.");
        document.getElementById("full-name").textContent = "Invalid URL: No Document ID found.";
        document.getElementById("dob").textContent = "Please add ?id=yourDocumentID to the URL.";
        return;
      }

      console.log("Fetching document for ID:", docId);
      try {
        const docRef = db.collection("Senior Data").doc(docId);
        const docSnap = await docRef.get();

        if (docSnap.exists) {
          const data = docSnap.data();
          console.log("Document Data Retrieved:", data);

          // Display fields with fallback for missing data
          document.getElementById("full-name").textContent = data["full_name"] ? `Full Name: ${data["full_name"]}` : "Full Name: N/A";
          document.getElementById("dob").textContent = data["date_of_birth"] ? `Date of Birth: ${data["date_of_birth"]}` : "Date of Birth: N/A";
          document.getElementById("address").textContent = data["address"] ? `Address: ${data["address"]}` : "Address: N/A";
          document.getElementById("phone").textContent = data["phone_number"] ? `Phone Number: ${data["phone_number"]}` : "Phone Number: N/A";
          document.getElementById("email").textContent = data["email"] ? `Email: ${data["email"]}` : "Email: N/A";
          document.getElementById("allergies").textContent = data["allergies"] ? `Allergies: ${data["allergies"]}` : "Allergies: N/A";
          document.getElementById("bloodtype").textContent = data["blood_type"] ? `Blood Type: ${data["blood_type"]}` : "Blood Type: N/A";
document.getElementById("DNR").textContent = data["do_not_resuscitate"] ? `Do you have Do Not Resuscitate order to upload?: ${data["do_not_resuscitate"]}` : "Do you have Do Not Resuscitate order to upload? N/A";
document.getElementById("insuranceprovider").textContent = data["insurance_provider"] ? `Insurance Provider: ${data["insurance_provider"]}` : "Insurance Provider: N/A";
document.getElementById("medications").textContent = data["medications"] ? `Current Medications: ${data["medications"]}` : "Current Medications: N/A";
document.getElementById("pastsurgeries").textContent = data["past_surgeries"] ? `Past Surgeries: ${data["past_surgeries"]}` : "Past Surgeries: N/A";
document.getElementById("policynumber").textContent = data["policy_number"] ? `Policy Number: ${data["policy_number"]}` : "Policy Number: N/A";
document.getElementById("preexistingconditions").textContent = data["pre_existing_conditions"] ? `Pre-existing Conditions: ${data["pre_existing_conditions"]}` : "Pre-existing Conditions: N/A";
document.getElementById("preferredhospital").textContent = data["preferred_hospital"] ? `Preferred Hospital: ${data["preferred_hospital"]}` : "Preferred Hospital: N/A";
document.getElementById("preferredlanguage").textContent = data["preferred_language"] ? `Preferred Language: ${data["preferred_language"]}` : "Preferred Language: N/A";
document.getElementById("pcontactname").textContent = data["primary_contact_name"] ? `Emergency Contact Name: ${data["primary_contact_name"]}` : "Emergency Contact Name: N/A";
document.getElementById("pcontactphone").textContent = data["primary_contact_phone"] ? `Emergency Contact Phone: ${data["primary_contact_phone"]}` : "Emergency Contact Phone: N/A";
document.getElementById("pphysicianname").textContent = data["primary_physician_name"] ? `Primary Physician Name: ${data["primary_physician_name"]}` : "Primary Physician Name: N/A";
document.getElementById("pphysicianphone").textContent = data["primary_physician_phone"] ? `Primary Physician Phone: ${data["primary_physician_phone"]}` : "Primary Physician Phone: N/A";
document.getElementById("relationship").textContent = data["relationship_to_primary_contact"] ? `Primary Contact relationship: ${data["relationship_to_primary_contact"]}` : "Primary Contact Relationship: N/A";
document.getElementById("timestamp").textContent = data["timestamp"] ? `Timestamp: ${data["timestamp"]}` : "Timestamp: N/A";

          // Display profile picture if available
          if (data["profile"]) {
            const profilePicture = document.getElementById("profile-picture");
            profilePicture.src = data["profile"];
            profilePicture.style.display = "block";
          }

          // Display PDF preview if available
          if (data["pdf"]) {
            const pdfPreview = document.getElementById("pdf-preview");
            pdfPreview.src = data["pdf"];
            pdfPreview.style.display = "block";
          }
        } else {
          console.error("Document does not exist for ID:", docId);
          document.getElementById("full-name").textContent = "404 Not Found: Document does not exist.";
        }
      } catch (error) {
        console.error("Error fetching document:", error);
        document.getElementById("full-name").textContent = "Error: Failed to load the data.";
      }
    }

    fetchData();
</script>
</body>
</html>
