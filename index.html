<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Portal</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Welcome to the Data Portal</h1>

    <!-- Timestamp Display (Placed above Personal Information) -->
    <h2 id="last-updated">Timestamp: Loading...</h2>

    <!-- Personal Information -->
    <h2>Personal Information</h2>
    <p id="full-name"></p>
    <p id="dob"></p>
    <p id="weight"></p>
    <p id="address"></p>
    <p id="phone"></p>
    <p id="preferredlanguage"></p>

    <!-- Emergency Contacts -->
    <h2>Emergency Contacts</h2>
    <p id="pcontactname"></p>
    <p id="relationship"></p>
    <p id="pcontactphone"></p>

    <!-- Medical Information -->
    <h2>Medical Information</h2>
    <p id="allergies"></p>
    <p id="medications"></p>
    <p id="preexistingconditions"></p>
    <p id="pastsurgeries"></p>
    <p id="bloodtype"></p>
    <p id="DNR"></p>
    <p id="otherinfo"></p>

    <!-- Physician & Hospital -->
    <h2>Physician & Hospital</h2>
    <p id="preferredhospital"></p>
    <p id="pphysicianname"></p>
    <p id="pphysicianphone"></p>

    <!-- Insurance Details -->
    <h2>Insurance Details</h2>
    <p id="insuranceprovider"></p>
    <p id="policynumber"></p>

    <!-- Profile Picture -->
    <h2>Profile Picture</h2>
    <div id="profile-picture-container">
        <img id="profile-picture" src="" alt="Profile Picture" style="max-width: 150px; max-height: 150px; display: none;"/>
    </div>

    <!-- PDF Preview -->
    <h2>Do Not Resuscitate (DNR) Form</h2>
    <div id="pdf-preview-container">
        <iframe id="pdf-preview" src="" style="width: 100%; height: 500px; display: none; border: 1px solid #ccc;"></iframe>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDNtdXr47xjKQOydo96uvzjYviZmO31jPo",
            authDomain: "rapidx-c05d4.firebaseapp.com",
            projectId: "rapidx-c05d4",
            storageBucket: "rapidx-c05d4.appspot.com",
            messagingSenderId: "340185921376",
            appId: "1:340185921376:web:5d088b0e41e027439bd005",
            measurementId: "G-25K8KBB70R"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Extract Document ID from URL Query Parameters
        const params = new URLSearchParams(window.location.search);
        const docId = params.get('id');

        async function fetchData() {
            if (!docId) {
                document.getElementById("full-name").textContent = "Invalid URL: No Document ID found.";
                return;
            }

            try {
                const docRef = db.collection("Senior Data").doc(docId);
                const docSnap = await docRef.get();

                if (docSnap.exists) {
                    const data = docSnap.data();

                    // Populate fields
                    document.getElementById("full-name").textContent = data["full_name"] ? `Full Name: ${data["full_name"]}` : "Full Name: N/A";
                    document.getElementById("dob").textContent = data["date_of_birth"] ? `Date of Birth: ${data["date_of_birth"]}` : "Date of Birth: N/A";
                    document.getElementById("weight").textContent = data["weight"] ? `Weight: ${data["weight"]}` : "Weight: N/A";
                    document.getElementById("address").textContent = data["address"] ? `Address: ${data["address"]}` : "Address: N/A";
                    document.getElementById("phone").textContent = data["phone_number"] ? `Phone Number: ${data["phone_number"]}` : "Phone Number: N/A";
                    document.getElementById("preferredlanguage").textContent = data["preferred_language"] ? `Preferred Language: ${data["preferred_language"]}` : "Preferred Language: N/A";

                    // Emergency Contacts
                    document.getElementById("pcontactname").textContent = data["primary_contact_name"] ? `Emergency Contact Name: ${data["primary_contact_name"]}` : "Emergency Contact Name: N/A";
                    document.getElementById("relationship").textContent = data["relationship_to_primary_contact"] ? `Relationship: ${data["relationship_to_primary_contact"]}` : "Relationship: N/A";
                    document.getElementById("pcontactphone").textContent = data["primary_contact_phone"] ? `Emergency Contact Phone: ${data["primary_contact_phone"]}` : "Emergency Contact Phone: N/A";

                    // Timestamp formatting
                    if (data["timestamp"]) {
                        const timestampElement = document.getElementById("last-updated");
                        const date = new Date(data["timestamp"].seconds * 1000); // Convert Firestore Timestamp to JS Date
                        timestampElement.textContent = `Timestamp: ${date.toLocaleString()}`;
                    } else {
                        document.getElementById("last-updated").textContent = "Timestamp: N/A";
                    }

                    // Display profile picture if available
                    if (data["profile"]) {
                        const profilePicture = document.getElementById("profile-picture");
                        profilePicture.src = data["profile"];
                        profilePicture.style.display = "block";
                    }

                    // Display PDF preview if available
                    if (data["pdf"]) {
                        const pdfPreview = document.getElementById("pdf-preview");
                        pdfPreview.src = data["pdf"];
                        pdfPreview.style.display = "block";
                    }
                } else {
                    document.getElementById("full-name").textContent = "404 Not Found: Document does not exist.";
                }
            } catch (error) {
                document.getElementById("full-name").textContent = "Error: Failed to load the data.";
            }
        }

        fetchData();
    </script>
</body>
</html>


