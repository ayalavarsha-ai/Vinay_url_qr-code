<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Portal</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Welcome to the Data Portal</h1>

    <!-- Timestamp Display (Placed above Personal Information) -->
    <h2 id="last-updated">Timestamp: Loading...</h2>

    <!-- Personal Information -->
    <h2>Personal Information</h2>
    <p id="full-name"></p>
    <p id="dob"></p>
    <p id="weight"></p>
    <p id="address"></p>
    <p id="phone"></p>
    <p id="preferredlanguage"></p>

    <!-- Emergency Contacts -->
    <h2>Emergency Contacts</h2>
    <p id="pcontactname"></p>
    <p id="relationship"></p>
    <p id="pcontactphone"></p>

    <!-- Medical Information -->
    <h2>Medical Information</h2>
    <p id="allergies"></p>
    <p id="medications"></p>
    <p id="preexistingconditions"></p>
    <p id="pastsurgeries"></p>
    <p id="bloodtype"></p>
    <p id="DNR"></p>
    <p id="otherinfo"></p>

    <!-- Physician & Hospital -->
    <h2>Physician & Hospital</h2>
    <p id="preferredhospital"></p>
    <p id="pphysicianname"></p>
    <p id="pphysicianphone"></p>

    <!-- Insurance Details -->
    <h2>Insurance Details</h2>
    <p id="insuranceprovider"></p>
    <p id="policynumber"></p>

    <!-- Profile Picture -->
    <h2>Profile Picture</h2>
    <div id="profile-picture-container">
        <img id="profile-picture" src="" alt="Profile Picture" style="max-width: 150px; max-height: 150px; display: none;"/>
    </div>

    <!-- PDF Preview -->
    <h2>Do Not Resuscitate (DNR) Form</h2>
    <div id="pdf-preview-container">
        <iframe id="pdf-preview" src="" style="width: 100%; height: 500px; display: none; border: 1px solid #ccc;"></iframe>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDNtdXr47xjKQOydo96uvzjYviZmO31jPo",
            authDomain: "rapidx-c05d4.firebaseapp.com",
            projectId: "rapidx-c05d4",
            storageBucket: "rapidx-c05d4.appspot.com",
            messagingSenderId: "340185921376",
            appId: "1:340185921376:web:5d088b0e41e027439bd005",
            measurementId: "G-25K8KBB70R"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Extract Document ID from URL Query Parameters
        const params = new URLSearchParams(window.location.search);
        const docId = params.get('id');

        // Function to format Firestore timestamp to MM/DD/YYYY, HH:MM:SS AM/PM (ET)
        function formatTimestampToET(timestamp) {
            if (!timestamp || !timestamp.seconds) return "Timestamp: N/A";
            
            const date = new Date(timestamp.seconds * 1000); // Convert Firestore Timestamp to JavaScript Date
            
            // Convert to Eastern Time (ET) using Intl.DateTimeFormat
            const options = {
                timeZone: "America/New_York", // Eastern Time Zone
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                hour12: true // Ensure AM/PM format
            };
            
            // Format Date to MM/DD/YYYY, HH:MM:SS AM/PM
            const formattedDate = new Intl.DateTimeFormat("en-US", options).format(date);
            
            return `Timestamp: ${formattedDate}`;
        }

        async function fetchData() {
            if (!docId) {
                document.getElementById("full-name").textContent = "Invalid URL: No Document ID found.";
                return;
            }

            try {
                const docRef = db.collection("Senior Data").doc(docId);
                const docSnap = await docRef.get();

                if (docSnap.exists) {
                    const data = docSnap.data();

                    // Format and display timestamp
                    const timestampElement = document.getElementById("last-updated");
                    timestampElement.textContent = data["timestamp"] ? formatTimestampToET(data["timestamp"]) : "Timestamp: N/A";

                    // Populate fields
                    document.getElementById("full-name").textContent = data["full_name"] ? `Full Name: ${data["full_name"]}` : "Full Name: N/A";
                    document.getElementById("dob").textContent = data["date_of_birth"] ? `Date of Birth: ${data["date_of_birth"]}` : "Date of Birth: N/A";
                    document.getElementById("weight").textContent = data["weight"] ? `Weight (in lbs) : ${data["weight"]}` : "Weight (in lbs) : N/A";
                    document.getElementById("address").textContent = data["address"] ? `Address: ${data["address"]}` : "Address: N/A";
                    document.getElementById("phone").textContent = data["phone_number"] ? `Phone Number: ${data["phone_number"]}` : "Phone Number: N/A";
                    document.getElementById("preferredlanguage").textContent = data["preferred_language"] ? `Preferred Language: ${data["preferred_language"]}` : "Preferred Language: N/A";
                    document.getElementById("email").textContent = data["email"] ? `Email: ${data["email"]}` : "Email: N/A";
                    document.getElementById("allergies").textContent = data["allergies"] ? `Allergies: ${data["allergies"]}` : "Allergies: N/A";
                    document.getElementById("bloodtype").textContent = data["blood_type"] ? `Blood Type: ${data["blood_type"]}` : "Blood Type: N/A";
                    document.getElementById("DNR").textContent = data["do_not_resuscitate"] ? `Do you have Do Not Resuscitate order to upload?: ${data["do_not_resuscitate"]}` : "Do you have Do Not Resuscitate order to upload? N/A";
                    document.getElementById("insuranceprovider").textContent = data["insurance_provider"] ? `Insurance Provider: ${data["insurance_provider"]}` : "Insurance Provider: N/A";
                    document.getElementById("medications").textContent = data["medications"] ? `Current Medications: ${data["medications"]}` : "Current Medications: N/A";
                    document.getElementById("pastsurgeries").textContent = data["past_surgeries"] ? `Past Surgeries: ${data["past_surgeries"]}` : "Past Surgeries: N/A";
                    document.getElementById("otherinfo").textContent = data["otherinfo"] ? `Other Information: ${data["otherinfo"]}` : "Other Information: N/A";
                    document.getElementById("policynumber").textContent = data["policy_number"] ? `Policy Number: ${data["policy_number"]}` : "Policy Number: N/A";
                    document.getElementById("preexistingconditions").textContent = data["pre_existing_conditions"] ? `Pre-existing Conditions: ${data["pre_existing_conditions"]}` : "Pre-existing Conditions: N/A";
                    document.getElementById("preferredhospital").textContent = data["preferred_hospital"] ? `Preferred Hospital: ${data["preferred_hospital"]}` : "Preferred Hospital: N/A";
                    document.getElementById("pcontactname").textContent = data["primary_contact_name"] ? `Emergency Contact Name: ${data["primary_contact_name"]}` : "Emergency Contact Name: N/A";
                    document.getElementById("pcontactphone").textContent = data["primary_contact_phone"] ? `Emergency Contact Phone: ${data["primary_contact_phone"]}` : "Emergency Contact Phone: N/A";
                    document.getElementById("pphysicianname").textContent = data["primary_physician_name"] ? `Primary Physician Name: ${data["primary_physician_name"]}` : "Primary Physician Name: N/A";
                    document.getElementById("pphysicianphone").textContent = data["primary_physician_phone"] ? `Primary Physician Phone: ${data["primary_physician_phone"]}` : "Primary Physician Phone: N/A";
                    document.getElementById("relationship").textContent = data["relationship_to_primary_contact"] ? `Primary Contact relationship: ${data["relationship_to_primary_contact"]}` : "Primary Contact Relationship: N/A";

                    // Display profile picture if available
                    if (data["profile"]) {
                        const profilePicture = document.getElementById("profile-picture");
                        profilePicture.src = data["profile"];
                        profilePicture.style.display = "block";
                    }

                    // Display PDF preview if available
                    if (data["pdf"]) {
                        const pdfPreview = document.getElementById("pdf-preview");
                        pdfPreview.src = data["pdf"];
                        pdfPreview.style.display = "block";
                    }
                } else {
                    document.getElementById("full-name").textContent = "404 Not Found: Document does not exist.";
                }
            } catch (error) {
                document.getElementById("full-name").textContent = "Error: Failed to load the data.";
            }
        }

        fetchData();
    </script>
</body>
</html>



