<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Data Portal</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Welcome to the Patient Data Portal</h1>
  <h2 id="full-name">Loading...</h2>
  <p id="dob"></p>
  <p id="address"></p>
  <p id="phone"></p>
  <p id="email"></p>
  <p id="timestamp"></p>

  <!-- Profile Picture -->
  <div id="profile-picture-container">
    <h3>Profile Picture</h3>
    <img id="profile-picture" src="" alt="Profile Picture" style="max-width: 150px; max-height: 150px; display: none;" />
  </div>

  <!-- PDF Preview -->
  <div id="pdf-preview-container">
    <h3>PDF Preview</h3>
    <iframe id="pdf-preview" src="" style="width: 100%; height: 500px; display: none; border: 1px solid #ccc;"></iframe>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDNtdXr47xjKQOydo96uvzjYviZmO31jPo",
      authDomain: "rapidx-c05d4.firebaseapp.com",
      projectId: "rapidx-c05d4",
      storageBucket: "rapidx-c05d4.appspot.com",
      messagingSenderId: "340185921376",
      appId: "1:340185921376:web:5d088b0e41e027439bd005",
      measurementId: "G-25K8KBB70R"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Extract Document ID from URL Query Parameters
    const params = new URLSearchParams(window.location.search);
    const docId = params.get('id'); // Get the 'id' query parameter
    console.log("Document ID from URL:", docId);

    async function fetchData() {
      if (!docId) {
        console.error("No Document ID provided in the URL.");
        document.getElementById("full-name").textContent = "Invalid URL: No Document ID found.";
        document.getElementById("dob").textContent = "Please add ?id=yourDocumentID to the URL.";
        return;
      }

      console.log("Fetching document for ID:", docId);
      try {
        const docRef = db.collection("Patient Data").doc(docId);
        const docSnap = await docRef.get();

        if (docSnap.exists) {
          const data = docSnap.data();
          console.log("Document Data Retrieved:", data);

          // Display fields with fallback for missing data
          document.getElementById("full-name").textContent = data["full_name"] ? `Full Name: ${data["full_name"]}` : "Full Name: N/A";
          document.getElementById("dob").textContent = data["date_of_birth"] ? `Date of Birth: ${data["date_of_birth"]}` : "Date of Birth: N/A";
          document.getElementById("address").textContent = data["address"] ? `Address: ${data["address"]}` : "Address: N/A";
          document.getElementById("phone").textContent = data["phone_number"] ? `Phone Number: ${data["phone_number"]}` : "Phone Number: N/A";
          document.getElementById("email").textContent = data["email"] ? `Email: ${data["email"]}` : "Email: N/A";
          document.getElementById("timestamp").textContent = data["timestamp"] ? `Timestamp: ${data["timestamp"]}` : "Timestamp: N/A";

          // Display profile picture if available
          if (data["profile"]) {
            const profilePicture = document.getElementById("profile-picture");
            profilePicture.src = data["profile"];
            profilePicture.style.display = "block";
          }

          // Display PDF preview if available
          if (data["pdf"]) {
            const pdfPreview = document.getElementById("pdf-preview");
            pdfPreview.src = data["pdf"];
            pdfPreview.style.display = "block";
          }
        } else {
          console.error("Document does not exist for ID:", docId);
          document.getElementById("full-name").textContent = "404 Not Found: Document does not exist.";
        }
      } catch (error) {
        console.error("Error fetching document:", error);
        document.getElementById("full-name").textContent = "Error: Failed to load the data.";
      }
    }

    fetchData();
  </script>
</body>
</html>
